{% extends "base.html" %}

{% block title %}Piano Tiles Leaderboard{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
            <h1 class="text-4xl font-bold text-white">üéπ Piano Tiles Leaderboard</h1>
            <p class="text-gray-400 mt-1">{{ mode_label }} - Top 10 All-Time</p>
        </div>
        <a href="/arcade/leaderboard/" class="text-primary-400 hover:text-primary-300 font-semibold">
            ‚Üê Back to Arcade
        </a>
    </div>

    <!-- Mode Filter -->
    <div class="flex flex-wrap gap-2">
        <a href="?hard_mode="
           class="px-4 py-2 rounded-lg font-semibold transition {% if not hard_mode_filter %}bg-primary-600 text-white{% else %}bg-dark-card text-gray-400 hover:bg-dark-surface{% endif %}">
            All Modes
        </a>
        <a href="?hard_mode=false"
           class="px-4 py-2 rounded-lg font-semibold transition {% if hard_mode_filter == 'false' %}bg-primary-600 text-white{% else %}bg-dark-card text-gray-400 hover:bg-dark-surface{% endif %}">
            Normal Mode
        </a>
        <a href="?hard_mode=true"
           class="px-4 py-2 rounded-lg font-semibold transition {% if hard_mode_filter == 'true' %}bg-primary-600 text-white{% else %}bg-dark-card text-gray-400 hover:bg-dark-surface{% endif %}">
            Hard Mode
        </a>
    </div>

    <!-- Leaderboard -->
    <div class="bg-dark-surface rounded-lg border border-dark-border overflow-hidden">
        {% if top_scores %}
        <div class="divide-y divide-dark-border">
            {% for piano_score in top_scores %}
            <div class="p-5 flex items-center justify-between transition
                        {% if highlight_id == piano_score.id|stringformat:'s' %}
                        bg-primary-900/30 border-l-4 border-primary-500 animate-pulse
                        {% else %}
                        hover:bg-dark-card/50
                        {% endif %}">
                <!-- Rank & User -->
                <div class="flex items-center space-x-4">
                    <div class="text-3xl font-bold w-12 text-center
                                {% if forloop.counter == 1 %}text-yellow-400
                                {% elif forloop.counter == 2 %}text-gray-300
                                {% elif forloop.counter == 3 %}text-orange-400
                                {% else %}text-gray-500{% endif %}">
                        {% if forloop.counter == 1 %}ü•á
                        {% elif forloop.counter == 2 %}ü•à
                        {% elif forloop.counter == 3 %}ü•â
                        {% else %}#{{ forloop.counter }}{% endif %}
                    </div>
                    <div>
                        <div class="text-xl font-bold text-white">
                            {{ piano_score.user.get_display_name }}
                        </div>
                        <div class="text-sm text-gray-400">
                            {{ piano_score.achieved_at|timesince }} ago
                            {% if piano_score.hard_mode %}
                            <span class="ml-2 bg-red-500/20 text-red-400 px-2 py-0.5 rounded text-xs font-bold">HARD</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Score -->
                <div class="text-4xl font-bold
                            {% if forloop.counter == 1 %}text-yellow-400
                            {% elif forloop.counter == 2 %}text-gray-300
                            {% elif forloop.counter == 3 %}text-orange-400
                            {% else %}text-primary-400{% endif %}">
                    {{ piano_score.score }}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="p-12 text-center text-gray-400">
            <div class="text-6xl mb-4">üéπ</div>
            <h2 class="text-2xl font-bold text-white mb-2">No Scores Yet</h2>
            <p>Be the first to set a record!</p>
        </div>
        {% endif %}
    </div>

    <!-- Auto-redirect countdown -->
    {% if highlight_id %}
    <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-4 text-center">
        <p class="text-yellow-300 font-semibold">
            Returning to arcade in <span id="countdown" class="text-2xl font-bold">{{ redirect_seconds }}</span> seconds...
        </p>
    </div>

    <script>
        let countdown = {{ redirect_seconds }};
        const countdownEl = document.getElementById('countdown');

        const timer = setInterval(() => {
            countdown--;
            countdownEl.textContent = countdown;

            if (countdown <= 0) {
                clearInterval(timer);
                window.location.href = '{{ redirect_url }}';
            }
        }, 1000);
    </script>
    {% endif %}
</div>
{% endblock %}
